# Internationalization (i18n) Guide

This document explains how to use and extend the internationalization support in kakei.

## Overview

Kakei uses [rust-i18n](https://github.com/longbridgeapp/rust-i18n) to provide multi-language support. All translations are embedded into the binary at compile time, making the application self-contained and usable offline without requiring external locale files at runtime.

## Supported Languages

Currently supported languages:

- **English (en)** - Default language
- **Japanese (ja)** - 日本語

## Usage

### Changing the Application Language

You can change the language in several ways:

#### 1. Using the RUST_I18N_LOCALE environment variable (Recommended)

```bash
# Use English (default)
kakei list

# Use Japanese
RUST_I18N_LOCALE=ja kakei list

# Use French (if added)
RUST_I18N_LOCALE=fr kakei list
```

#### 2. Using the LANG environment variable

The application will automatically detect the language from your system's `LANG` setting:

```bash
# Japanese
LANG=ja_JP.UTF-8 kakei init

# English
LANG=en_US.UTF-8 kakei init
```

## Adding a New Language

To add support for a new language, follow these steps:

### Step 1: Create a New Locale File

Create a new YAML file in the `locales/` directory with the language code as the filename. For example, to add French support:

```bash
touch locales/fr.yml
```

### Step 2: Add Translations

Copy the structure from `locales/en.yml` and translate all the strings to your target language:

```yaml
# locales/fr.yml

# Success messages
transaction_added: "✅ Transaction ajoutée avec succès ! (ID: %{id})"
init_complete: "✅ Initialisation terminée. Base de données prête à : %{path}"

# Error messages
transaction_add_failed: "❌ Échec de l'ajout de la transaction : %{error}"
init_failed: "❌ Échec de l'initialisation de la base de données : %{error}"
transaction_list_failed: "❌ Échec de la récupération des transactions : %{error}"
transform_failed: "❌ Échec de la transformation des transactions : %{error}"

# List command
no_transactions: "Aucune transaction trouvée."

# Table headers
date: "Date"
amount: "Montant"
category: "Catégorie"
account: "Compte"
memo: "Mémo"

# Transform command
group_header: "=== %{group} ==="
no_transactions_in_group: "Aucune transaction dans ce groupe."
```

### Step 3: Rebuild the Application

Rebuild the application to embed the new translations:

```bash
cargo build --release
```

### Step 4: Test the New Language

Test your new translation:

```bash
RUST_I18N_LOCALE=fr ./target/release/kakei init
```

## Translation Guidelines

When adding or updating translations:

1. **Preserve placeholders**: Keep variable placeholders like `%{id}`, `%{error}`, `%{path}`, etc. in the translated text
1. **Maintain formatting**: Keep emojis and formatting consistent across translations (✅, ❌, ===)
1. **Use natural language**: Translate the meaning, not just word-for-word
1. **Test thoroughly**: Always test the translations in context to ensure they make sense

## Technical Details

### How It Works

1. The `rust_i18n::i18n!()` macro is called in `src/main.rs` to initialize the translation system
1. At compile time, rust-i18n scans the `locales/` directory and embeds all YAML files into the binary
1. At runtime, the application detects the desired locale from environment variables
1. The `t!()` macro is used throughout the code to translate strings

### Key Files

- `locales/` - Directory containing all locale YAML files
- `src/main.rs` - Contains the `i18n!()` initialization macro
- `build.rs` - Build script that triggers recompilation when locale files change
- `Cargo.toml` - Dependencies including `rust-i18n`

### Variable Interpolation

You can use variables in translations using the `%{variable_name}` syntax:

```yaml
welcome_message: "Welcome, %{name}!"
```

Then in code:

```rust
println!("{}", t!("welcome_message", name = user_name));
```

## Contributing Translations

If you'd like to contribute a new translation:

1. Fork the repository
1. Add your locale file following the steps above
1. Test your translation thoroughly
1. Submit a pull request with:
   - The new locale file
   - Updated documentation if needed
   - Examples showing the translation in use

## Resources

- [rust-i18n Documentation](https://github.com/longbridgeapp/rust-i18n)
- [YAML Syntax Guide](https://yaml.org/spec/1.2/spec.html)
- [ISO 639-1 Language Codes](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes)
